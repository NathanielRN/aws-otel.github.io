{"componentChunkName":"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js","path":"/docs/getting-started/prometheus-remote-write-exporter","result":{"data":{"mdx":{"id":"29ad1305-d261-589d-a787-76f5dda4e14b","excerpt":"In order to scrape and export metrics to your AWS Managed Service for Prometheus (AMP) instance, you can use either the AWS Distro for \nthe OpenTelemetry…","fields":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/"},"frontmatter":{"title":"Getting Started with Prometheus Remote Write Exporter for AMP","description":"In this Getting Started guide, we’ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application, and send metrics to AWS Managed Service for Prometheus (AMP).","image":null,"disableTableOfContents":null},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Getting Started with Prometheus Remote Write Exporter for AMP\",\n  \"description\": \"In this Getting Started guide, we’ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application, and send metrics to AWS Managed Service for Prometheus (AMP).\",\n  \"path\": \"/docs/getting-started/prometheus-remote-write-exporter\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In order to scrape and export metrics to your AWS Managed Service for Prometheus (AMP) instance, you can use either the AWS Distro for\\nthe OpenTelemetry Collector (ADOT Collector) or a standard vanilla Prometheus server.\"), mdx(\"p\", null, \"In this Getting Started guide, we\\u2019ll show you how to configure the ADOT Collector to scrape from a Prometheus-instrumented application,\\nand send metrics to the AWS Managed Service for Prometheus (AMP).\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"before-you-begin\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#before-you-begin\",\n    \"aria-label\": \"before you begin permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Before you Begin\"), mdx(\"p\", null, \"The ADOT-AMP pipeline enables us to use the ADOT Collector to scrape a Prometheus-instrumented application, and send the scraped metrics\\nto AWS Managed Service for Prometheus (AMP). \"), mdx(\"img\", {\n    src: prometheusPipelineImg,\n    alt: \"Diagram\",\n    style: {\n      \"margin\": \"30px 0\"\n    }\n  }), mdx(\"p\", null, \"The ADOT-AMP pipeline includes two OpenTelemetry Collector components specific to Prometheus \\u2014 the Prometheus Receiver and the AWS Prometheus\\nRemote Write Exporter. \"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"service-discovery\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#service-discovery\",\n    \"aria-label\": \"service discovery permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Service Discovery\"), mdx(\"p\", null, \"The Prometheus Receiver can be configured using your existing\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://prometheus.io/docs/prometheus/latest/configuration/configuration/\"\n  }), \"Prometheus configurations\"), \" to perform service discovery and metric\\nscraping. There are many possible configurations to discover monitored targets including Kubernetes service discovery (kubernetes_sd_config)\\nand static hosts (static_config). Note that the Prometheus Receiver will scrape metrics in the Prometheus exposition format. Any applications\\nor endpoints that you want to scrape should be configured with the Prometheus client library.\"), mdx(\"p\", null, \"The AWS Prometheus Remote Write Exporter will use the remote_write endpoint to send the scraped metrics to an AMP instance. The HTTPs requests\\nused to export data will be signed with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html\"\n  }), \"AWS SigV4\"), \", AWS\\u2019\\nauthentication protocol for secure authentication.\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"basic-eks-configuration-for-amp\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#basic-eks-configuration-for-amp\",\n    \"aria-label\": \"basic eks configuration for amp permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Basic EKS Configuration for AMP\"), mdx(\"p\", null, \"Now, we'll enable Prometheus collection on an EKS cluster. In this scenario, we will use the Prometheus Receiver to perform service discovery in\\nan EKS cluster and metric scraping. We will scrape from an application that provides us with some example Prometheus metrics.\"), mdx(\"p\", null, \"For information about advanced configurations and how to scrape Kubernetes infrastructure with the ADOT Collector-AMP pipeline, please take a look\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }), \"here\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"prerequisites\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#prerequisites\",\n    \"aria-label\": \"prerequisites permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Prerequisites\"), mdx(\"p\", null, \"Before getting started, you will need to set up the following components:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"An AMP workspace should be set up. Guides for this can be found \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/prometheus/latest/userguide/what-is-Amazon-Managed-Service-Prometheus.html\"\n  }), \"here\"), \". \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"AWS credentials from any of the options in the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html\"\n  }), \"default AWS credentials chain\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A Kubernetes or EKS cluster. If you need to set up an EKS cluster, please use the following \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html\"\n  }), \"guide\"), \".\\nYou can check the name of the active context/cluster using this command \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"kubectl config current-context\"), \".\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"sample-app\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#sample-app\",\n    \"aria-label\": \"sample app permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Sample App\"), mdx(\"p\", null, \"We will be using a simple sample app that is used for the integration tests of this pipeline. You can find the sample app \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/aws-observability/aws-otel-community\"\n  }), \"here\"), \".\"), mdx(\"p\", null, \"First, fork the repository. Then clone the repository and run the following commands:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ cd ./sample-apps/prometheus\\n$ docker build . -t prometheus-sample-app:latest\\n\")), mdx(\"p\", null, \"In order to use this Docker image for Kubernetes, we need to push this image to a registry. You will need to push your image to your Amazon ECR or DockerHub registry. \"), mdx(\"p\", null, \"To deploy the sample app in EKS, copy this Kubernetes configuration and apply it. Make sure to use the latest image that was pushed.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ curl https://raw.githubusercontent.com/aws-observability/aws-otel-collector/main/examples/eks/prometheus-pipeline/prometheus-sample-app.yaml -o prometheus-sample-app.yaml\\n$ kubectl apply -f prometheus-sample-app.yaml\\n\")), mdx(\"p\", null, \"You can use the following command to verify that the sample app has started:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ kubectl get all -n aoc-prometheus-pipeline-demo\\nNAME                                        READY   STATUS    RESTARTS   AGE\\npod/prometheus-sample-app-6bfd56b57-8mzsb   1/1     Running   0          15m\\n\\nNAME                                    TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\\nservice/prometheus-sample-app-service   NodePort   10.100.246.31   <none>        8080:31653/TCP   15m\\n\\nNAME                                    READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/prometheus-sample-app   1/1     1            1           15m\\n\\nNAME                                              DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/prometheus-sample-app-6bfd56b57   1         1         1       15m\\n\")), mdx(\"p\", null, \"Any applications that you want to scrape should be instrumented with a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://prometheus.io/docs/instrumenting/clientlibs/\"\n  }), \"Prometheus client\"), \"\\n(this exposes Prometheus exposition metrics to a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/metrics\"), \" endpoint). This is done in the sample app as well.\"), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"aws-distro-for-opentelemetry-adot-collector-setup\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#aws-distro-for-opentelemetry-adot-collector-setup\",\n    \"aria-label\": \"aws distro for opentelemetry adot collector setup permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"AWS Distro for OpenTelemetry (ADOT) Collector Setup\"), mdx(\"p\", null, \"To start a default instance of the Collector, we have provided an example template configuration. You will have to change the \\u201Cendpoint\\u201D and\\n\\u201Cregion\\u201D to correspond with your own AMP workspace. The changes should be with respect to the AWS Prometheus Remote Write Exporter\\u2019s configuration. \"), mdx(\"p\", null, \"For Example:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }), \"exporters:\\n  awsprometheusremotewrite:\\n    endpoint: \\\"https://aps-workspaces.us-west-2.amazonaws.com/workspaces/ws-d26e36bf-361j-480c-94f0-54bd7370f997/api/v1/remote_write\\\"\\n    aws_auth:\\n      service: \\\"aps\\\"\\n      region: \\\"us-west-2\\\"\\n\")), mdx(\"p\", null, \"We will use an example Kubernetes configuration template from the aws-otel-collector repository in order to deploy the ADOT Collector.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Note: in this example, the ADOT Collector configurations uses Prometheus\\u2019s Kubernetes service discovery in order to automatically find\\nthe sample app endpoint. An annotation (scrape=true) is used to determine which target endpoints to scrape. (This allows the ADOT Collector\\nto distinguish between our sample app endpoint from kube-system endpoints within your cluster.) Feel free to remove this from the relabel\\nconfigurations if you would like to scrape a different application.\")), mdx(\"p\", null, \"To pull the Kubernetes configuration for ADOT Collector:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ curl https://raw.githubusercontent.com/aws-observability/aws-otel-collector/main/examples/eks/prometheus-pipeline/eks-prometheus-sidecar.yaml -o eks-prometheus-sidecar.yaml\\n\")), mdx(\"p\", null, \"Now, to deploy the ADOT Collector in EKS, apply this Kubernetes config:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ kubectl apply -f eks-prometheus-sidecar.yaml\\n\")), mdx(\"p\", null, \"You can verify that the ADOT Collector has started with this command:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ kubectl get pods -n adot-col\\nNAMESPACE              NAME                                         READY   STATUS             RESTARTS   AGE\\nadot-col               adot-collector-7bc7c                         1/1     Running            0          3m17s\\n\")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"verifying-the-pipeline-works\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#verifying-the-pipeline-works\",\n    \"aria-label\": \"verifying the pipeline works permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Verifying the Pipeline Works\"), mdx(\"p\", null, \"The logging exporter can be used to verify that metrics were scraped by the Prometheus Receiver. This example is already hooked up with the\\nlogging exporter. You can check the logs with these commands:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ kubectl get pods -A\\n$ kubectl logs -n adot-col [name_of_your_adot_collector_pod]\\n\")), mdx(\"p\", null, \"An example of the scraped metrics in the logging exporter:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"Resource labels:\\n     -> service.name: STRING(kubernetes-service-endpoints)\\n     -> host.name: STRING(192.168.16.238)\\n     -> port: STRING(8080)\\n     -> scheme: STRING(http)\\nInstrumentationLibraryMetrics #0\\nMetric #0\\nDescriptor:\\n     -> Name: test_gauge0\\n     -> Description: This is my gauge\\n     -> Unit: \\n     -> DataType: DoubleGauge\\nDoubleDataPoints #0\\nStartTime: 0\\nTimestamp: 1606511460471000000\\nValue: 0.000000\\n\")), mdx(\"p\", null, \"In order to test if AMP received those metrics, we can use the awscurl. This tool allows us to send HTTPs requests through the command line with AWS\\nSigv4 authentication. In order to use this, make sure you have set the correct permissions to query from AMP in your local AWS credentials. Please use\\nthis guide to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/okigan/awscurl\"\n  }), \"install awscurl\"), \".\"), mdx(\"p\", null, \"You can use the following command below to check if a metric was received in AMP. The region and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AMP_ENDPOINT\"), \" will have to be changed\\ncorresponding to your AMP workspace.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ awscurl --service=\\\"aps\\\" --region=\\\"region\\\" \\\"https://{AMP_ENDPOINT}/api/v1/query?query=adot_test_gauge0\\\"\\n{\\\"status\\\":\\\"success\\\",\\\"data\\\":{\\\"resultType\\\":\\\"vector\\\",\\\"result\\\":[{\\\"metric\\\":{\\\"__name__\\\":\\\"adot_test_gauge0\\\"},\\\"value\\\":[1606512592.493,\\\"16.87214000011479\\\"]}]}}\\n\")), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Note\"), \": \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"we added a \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"namespace: adot\"), \" value in the ADOT Collector yaml file to prefix each metric that is exported by ADOT Collector with \", mdx(\"inlineCode\", {\n    parentName: \"em\"\n  }, \"adot_\"), \". \")), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"it-works\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#it-works\",\n    \"aria-label\": \"it works permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"It Works!\"), mdx(\"p\", null, \"If you receive a metric as the response, that means your pipeline setup is successful! This metric has successfully propagated from the sample app into AMP. \"), mdx(\"p\", null, \"Similar pipelines can be configured using the components mentioned above to scrape your Kubernetes cluster and applications. Please refer below for advanced configurations.\"), mdx(SubSectionSeparator, {\n    mdxType: \"SubSectionSeparator\"\n  }), mdx(\"h3\", {\n    \"id\": \"cleaning-up\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#cleaning-up\",\n    \"aria-label\": \"cleaning up permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Cleaning up\"), mdx(\"p\", null, \"Run the following commands to clean up your EKS cluster.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"$ kubectl delete namespace aoc-prometheus-pipeline-demo\\n$ kubectl delete namespace adot-col\\n\")), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"components-in-our-pipeline\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#components-in-our-pipeline\",\n    \"aria-label\": \"components in our pipeline permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Components in our Pipeline\"), mdx(\"h4\", {\n    \"id\": \"prometheus-receiver\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#prometheus-receiver\",\n    \"aria-label\": \"prometheus receiver permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Prometheus Receiver\"), mdx(\"p\", null, \"The Prometheus Receiver supports the full set of Prometheus scraping and re-labeling configurations described\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://prometheus.io/docs/prometheus/latest/configuration/configuration/\"\n  }), \"here\"), \". You should be able to directly paste in these configurations into your\\nADOT Collector configurations. \"), mdx(\"p\", null, \"The configuration for the Prometheus Receiver will include your service discovery, scraping configurations, and re-labeling configurations. The\\nreceiver configurations will look like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }), \"receivers:\\n  prometheus:\\n    config:\\n      [Your Prometheus configurations]\\n\")), mdx(\"p\", null, \"An example configuration is shown below. \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }), \"receivers:\\n  prometheus:\\n    config:\\n      global:\\n        scrape_interval: 1m\\n        scrape_timeout: 10s\\n        \\n      scrape_configs:\\n      - job_name: kubernetes-service-endpoints\\n        sample_limit: 10000\\n        kubernetes_sd_configs:\\n        - role: endpoints\\n        tls_config:\\n          ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt\\n          insecure_skip_verify: true\\n        bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note:\"), \" To perform Kubernetes service discovery, you will need to set up the proper permissions and RBAC authorization for the service account\\n(to allow it to access the Kubernetes API). Please refer to the Permissions section in the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }), \"advanced configurations doc\"), \".\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note: If you have existing Prometheus configurations, you will need to replace the \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"$\"), \" characters with \", mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"$$\"), \" to avoid having the value replaced with environment variables. \"), \"\\nThis is especially important for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"replacement\"), \" value of the relabel_configurations. For instance, the following configuration for relabel_configurations below \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"relabel_configs:\\n- source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]\\n  regex: (.+);(.+);(.+)\\n  replacement: ${1}://${2}${3}\\n  target_label: __param_target\\n\")), mdx(\"p\", null, \"would become \"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"relabel_configs:\\n- source_labels: [__meta_kubernetes_ingress_scheme,__address__,__meta_kubernetes_ingress_path]\\n  regex: (.+);(.+);(.+)\\n  replacement: $${1}://${2}${3}\\n  target_label: __param_target\\n\")), mdx(\"h4\", {\n    \"id\": \"aws-prometheus-remote-write-exporter\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#aws-prometheus-remote-write-exporter\",\n    \"aria-label\": \"aws prometheus remote write exporter permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"AWS Prometheus Remote Write Exporter\"), mdx(\"p\", null, \"The configuration for the AWS Prometheus Remote Write Exporter is a lot simpler than the Prometheus receiver. At this stage in the pipeline, metrics\\nhave already been ingested, and we\\u2019re ready to export this data to AMP. The minimum requirement for a successful configuration to communicate with AMP is as follows:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\",\n    \"metastring\": \"lineNumbers=true\",\n    \"lineNumbers\": \"true\"\n  }), \"exporters:\\n  awsprometheusremotewrite:\\n    endpoint: \\\"https://aws-managed-prometheus-endpoint/v1/api/remote_write\\\"\\n    aws_auth:\\n      service: \\\"aps\\\"\\n      region: \\\"user-region\\\"\\n\")), mdx(\"p\", null, \"This configuration sends an HTTPS request that is signed by AWS SigV4 using the credentials that are set up from the prerequisites section. It is\\nmandatory that customers specify the service to be \\u201Caps\\u201D\"), mdx(\"p\", null, \"Regardless of the method of deployment, the ADOT Collector must have access to one of the listed options in the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html\"\n  }), \"default AWS credentials chain\"), \". The AWS Prometheus Remote Write\\nExporter depends on the AWS Go SDK and uses it to fetch credentials and authenticate. You must ensure that these credentials have remote writing\\npermissions to AMP (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"aps:RemoteWrite\"), \").\"), mdx(SectionSeparator, {\n    mdxType: \"SectionSeparator\"\n  }), mdx(\"h2\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Conclusion\"), mdx(\"p\", null, \"This document has gone over what the basic requirements are to get set up with the ADOT Collector to collect and export Prometheus metrics to AMP.\\nWith this, you should be able to use the aforementioned tools to have a clean solution to observability on your software systems. \"), mdx(\"p\", null, \"For more advanced configurations with the ADOT Collector-AMP, please take a look \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/docs/getting-started/advanced-prometheus-remote-write-configurations\"\n  }), \"here\"), \".\"), mdx(\"p\", null, \"We would love to hear more common configuration scenarios or improvements to this documentation from you! Please submit an issue\\non the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/aws-observability/aws-otel-community\"\n  }), \"aws-otel community\"), \" to let us know.\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"depth":2,"value":"Before you Begin"},{"depth":2,"value":"Service Discovery"},{"depth":2,"value":"Basic EKS Configuration for AMP"},{"depth":3,"value":"Prerequisites"},{"depth":3,"value":"Sample App"},{"depth":3,"value":"AWS Distro for OpenTelemetry (ADOT) Collector Setup"},{"depth":3,"value":"Verifying the Pipeline Works"},{"depth":3,"value":"It Works!"},{"depth":3,"value":"Cleaning up"},{"depth":2,"value":"Components in our Pipeline"},{"depth":4,"value":"Prometheus Receiver"},{"depth":4,"value":"AWS Prometheus Remote Write Exporter"},{"depth":2,"value":"Conclusion"}]}},"pageContext":{"slug":"/docs/getting-started/prometheus-remote-write-exporter/","githubEditUrl":"https://github.com/rocketseat/gatsby-themes/tree/master/examples/gatsby-theme-docs/src/docs/getting-started/prometheus-remote-write-exporter.mdx"}},"staticQueryHashes":["2501019404","973074209"]}